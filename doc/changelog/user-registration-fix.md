# ç”¨æˆ·æ³¨å†Œæ¨¡å—ä¿®å¤è®°å½•

## é—®é¢˜æ¦‚è¿°

åç«¯ç”¨æˆ·æ³¨å†Œæ¨¡å—å­˜åœ¨å¤šä¸ªå…³é”®é—®é¢˜ï¼Œå¯¼è‡´æ³¨å†ŒåŠŸèƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚

## å‘ç°çš„é—®é¢˜

### 1. æ•°æ®ç»“æ„ä¸åŒ¹é…
- **å‰ç«¯å‘é€**: `{ username, password, email }`
- **åç«¯æ¥æ”¶**: `{ email, password, confirmPassword }`
- **æ•°æ®åº“å­˜å‚¨**: ç¼ºå°‘ `username` å­—æ®µ

### 2. å­—æ®µç¼ºå¤±é—®é¢˜
- å‰ç«¯å‘é€ `username` å­—æ®µï¼Œä½†åç«¯æ²¡æœ‰å¤„ç†
- æ•°æ®åº“è¡¨ç»“æ„ç¼ºå°‘ `username` å­—æ®µ
- å‰ç«¯APIè°ƒç”¨ä¸åç«¯æ¥å£å®šä¹‰ä¸ä¸€è‡´

### 3. å¯†ç ç¡®è®¤é€»è¾‘ç¼ºå¤±
- å‰ç«¯æ²¡æœ‰å‘é€ `confirmPassword` å­—æ®µ
- åç«¯æœŸæœ› `confirmPassword` ä½†å‰ç«¯æ²¡æœ‰æä¾›

### 4. å“åº”æ ¼å¼ä¸ç»Ÿä¸€
- åç«¯ä½¿ç”¨ `c.String()` è¿”å›çº¯æ–‡æœ¬
- å‰ç«¯æœŸæœ›JSONæ ¼å¼çš„å“åº”
- é”™è¯¯å¤„ç†ä¸å¤Ÿè¯¦ç»†

## ä¿®å¤æ–¹æ¡ˆ

### 1. æ•°æ®ç»“æ„ç»Ÿä¸€

#### ä¿®å¤å‰
```go
type SignupReq struct {
    Email           string `json:"email"`
    ConfirmPassword string `json:"confirmPassword"`
    Password        string `json:"password"`
}
```

#### ä¿®å¤å
```go
type SignupReq struct {
    Username string `json:"username"`
    Email    string `json:"email"`
    Password string `json:"password"`
}
```

### 2. æ•°æ®åº“è¡¨ç»“æ„æ›´æ–°

#### æ·»åŠ Usernameå­—æ®µ
```go
type User struct {
    Id       int64 `gorm:"primaryKey,autoIncrement"`
    Username string `gorm:"unique"`
    Email    string `gorm:"unique"`
    Password string
    Ctime    int64
    Utime    int64
}
```

### 3. å®Œå–„é”™è¯¯å¤„ç†

#### æ·»åŠ ç”¨æˆ·åå†²çªæ£€æŸ¥
```go
if strings.Contains(mysqlErr.Message, "username") {
    return errors.New("ç”¨æˆ·åå·²è¢«ä½¿ç”¨")
}
if strings.Contains(mysqlErr.Message, "email") {
    return ErrUserDuplicateEmail
}
```

#### ç»Ÿä¸€å“åº”æ ¼å¼
```go
c.JSON(http.StatusOK, gin.H{
    "code":    200,
    "message": "æ³¨å†ŒæˆåŠŸ",
    "data": gin.H{
        "username": req.Username,
        "email":    req.Email,
    },
})
```

### 4. æ”¯æŒç”¨æˆ·åæˆ–é‚®ç®±ç™»å½•

#### æ·»åŠ ç”¨æˆ·åæŸ¥æ‰¾æ–¹æ³•
```go
func (dao *UserDAO) FindByUsername(ctx context.Context, username string) (User, error) {
    var u User
    err := dao.db.WithContext(ctx).Where("username = ?", username).First(&u).Error
    return u, err
}
```

#### æ™ºèƒ½ç™»å½•é€»è¾‘
```go
// å…ˆå°è¯•é€šè¿‡é‚®ç®±æŸ¥æ‰¾ç”¨æˆ·
u, err = svc.repo.FindByEmail(ctx, username)
if err != nil {
    // å¦‚æœé‚®ç®±æŸ¥æ‰¾å¤±è´¥ï¼Œå°è¯•é€šè¿‡ç”¨æˆ·åæŸ¥æ‰¾
    u, err = svc.repo.FindByUsername(ctx, username)
    if err != nil {
        return domain.User{}, ErrInvaildUserOrPassword
    }
}
```

## ä¿®å¤çš„æ–‡ä»¶

### 1. æ•°æ®ç»“æ„å±‚
- `server/src/domain/user.go` - æ·»åŠ Usernameå­—æ®µ
- `server/src/repository/dao/user.go` - æ›´æ–°DAOå±‚Userç»“æ„ä½“

### 2. ä¸šåŠ¡é€»è¾‘å±‚
- `server/src/service/user.go` - æ·»åŠ ç”¨æˆ·åå†²çªå¤„ç†å’Œæ™ºèƒ½ç™»å½•
- `server/src/repository/user.go` - æ›´æ–°Repositoryå±‚æ–¹æ³•

### 3. æ¥å£å±‚
- `server/src/web/user.go` - ä¿®å¤æ³¨å†Œå’Œç™»å½•æ¥å£

### 4. æ•°æ®åº“è¿ç§»
- `scripts/migrate_users_table.sql` - æ•°æ®åº“è¡¨ç»“æ„æ›´æ–°è„šæœ¬

### 5. æµ‹è¯•è„šæœ¬
- `scripts/test_user_registration.sh` - Linux/macOSæµ‹è¯•è„šæœ¬
- `scripts/test_user_registration.bat` - Windowsæµ‹è¯•è„šæœ¬

## ä¿®å¤åçš„åŠŸèƒ½ç‰¹æ€§

### 1. ç”¨æˆ·æ³¨å†Œ
- âœ… æ”¯æŒç”¨æˆ·åã€é‚®ç®±ã€å¯†ç æ³¨å†Œ
- âœ… ç”¨æˆ·åå’Œé‚®ç®±å”¯ä¸€æ€§æ£€æŸ¥
- âœ… å¯†ç å¼ºåº¦éªŒè¯
- âœ… ç»Ÿä¸€çš„JSONå“åº”æ ¼å¼
- âœ… è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

### 2. ç”¨æˆ·ç™»å½•
- âœ… æ”¯æŒç”¨æˆ·åæˆ–é‚®ç®±ç™»å½•
- âœ… æ™ºèƒ½è¯†åˆ«ç™»å½•æ–¹å¼
- âœ… å¯†ç åŠ å¯†éªŒè¯
- âœ… ä¼šè¯ç®¡ç†
- âœ… ç»Ÿä¸€çš„JSONå“åº”æ ¼å¼

### 3. æ•°æ®éªŒè¯
- âœ… å¿…å¡«å­—æ®µæ£€æŸ¥
- âœ… é‚®ç®±æ ¼å¼éªŒè¯
- âœ… å¯†ç å¼ºåº¦éªŒè¯
- âœ… ç”¨æˆ·åå’Œé‚®ç®±å”¯ä¸€æ€§éªŒè¯

### 4. é”™è¯¯å¤„ç†
- âœ… HTTPçŠ¶æ€ç æ ‡å‡†åŒ–
- âœ… è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- âœ… ç»Ÿä¸€çš„å“åº”æ ¼å¼
- âœ… ä¸šåŠ¡é€»è¾‘é”™è¯¯åˆ†ç±»

## æµ‹è¯•éªŒè¯

### æµ‹è¯•ç”¨ä¾‹
1. **æ­£å¸¸æ³¨å†Œ** - éªŒè¯åŸºæœ¬æ³¨å†ŒåŠŸèƒ½
2. **é‡å¤ç”¨æˆ·å** - éªŒè¯ç”¨æˆ·åå”¯ä¸€æ€§
3. **é‡å¤é‚®ç®±** - éªŒè¯é‚®ç®±å”¯ä¸€æ€§
4. **å¼±å¯†ç ** - éªŒè¯å¯†ç å¼ºåº¦è¦æ±‚
5. **æ— æ•ˆé‚®ç®±** - éªŒè¯é‚®ç®±æ ¼å¼æ£€æŸ¥
6. **ç”¨æˆ·åç™»å½•** - éªŒè¯ç”¨æˆ·åç™»å½•
7. **é‚®ç®±ç™»å½•** - éªŒè¯é‚®ç®±ç™»å½•

### è¿è¡Œæµ‹è¯•
```bash
# Linux/macOS
chmod +x scripts/test_user_registration.sh
./scripts/test_user_registration.sh

# Windows
scripts/test_user_registration.bat
```

## éƒ¨ç½²æ³¨æ„äº‹é¡¹

### 1. æ•°æ®åº“è¿ç§»
åœ¨éƒ¨ç½²å‰éœ€è¦è¿è¡Œæ•°æ®åº“è¿ç§»è„šæœ¬ï¼š
```sql
source scripts/migrate_users_table.sql
```

### 2. æœåŠ¡é‡å¯
ä¿®å¤å®Œæˆåéœ€è¦é‡å¯åç«¯æœåŠ¡ä»¥åº”ç”¨æ›´æ”¹ã€‚

### 3. å‰ç«¯å…¼å®¹æ€§
å‰ç«¯ä»£ç æ— éœ€ä¿®æ”¹ï¼ŒAPIè°ƒç”¨å·²ç»ä¸åç«¯æ¥å£åŒ¹é…ã€‚

## åç»­ä¼˜åŒ–å»ºè®®

### 1. åŠŸèƒ½å¢å¼º
- æ·»åŠ é‚®ç®±éªŒè¯åŠŸèƒ½
- å®ç°å¯†ç é‡ç½®åŠŸèƒ½
- æ·»åŠ ç”¨æˆ·å¤´åƒæ”¯æŒ
- å®ç°ç¬¬ä¸‰æ–¹ç™»å½•

### 2. å®‰å…¨æ€§æå‡
- æ·»åŠ ç™»å½•å¤±è´¥æ¬¡æ•°é™åˆ¶
- å®ç°JWT tokenè®¤è¯
- æ·»åŠ APIè®¿é—®é¢‘ç‡é™åˆ¶
- å®ç°æ•æ„Ÿæ“ä½œæ—¥å¿—è®°å½•

### 3. æ€§èƒ½ä¼˜åŒ–
- ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
- å®ç°ç”¨æˆ·ä¿¡æ¯ç¼“å­˜
- æ·»åŠ æ•°æ®åº“è¿æ¥æ± 
- å®ç°å¼‚æ­¥é‚®ä»¶å‘é€

## æ€»ç»“

é€šè¿‡è¿™æ¬¡ä¿®å¤ï¼Œç”¨æˆ·æ³¨å†Œæ¨¡å—ç°åœ¨å…·å¤‡äº†ï¼š
- ğŸ¯ å®Œæ•´çš„æ•°æ®ç»“æ„æ”¯æŒ
- ğŸ”’ å®Œå–„çš„éªŒè¯å’Œå®‰å…¨æœºåˆ¶
- ğŸ“± çµæ´»çš„ç™»å½•æ–¹å¼
- ğŸš€ ç»Ÿä¸€çš„APIå“åº”æ ¼å¼
- ğŸ§ª å…¨é¢çš„æµ‹è¯•è¦†ç›–

æ•´ä¸ªæ³¨å†Œæµç¨‹ç°åœ¨å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œç”¨æˆ·ä½“éªŒå¾—åˆ°äº†æ˜¾è‘—æå‡ã€‚
